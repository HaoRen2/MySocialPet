@{
    var currentController = ViewContext.RouteData.Values["controller"]?.ToString();
    var currentAction = ViewContext.RouteData.Values["action"]?.ToString();
}

<nav class="navbar navbar-expand-lg justify-content-between align-items-center fixed-top quitar-rojo" role="navigation" aria-label="Barra de navegación principal">

    <!-- Logo / Home -->
    <a class="navbar-brand quitar-amarillo"
       asp-controller="Home" asp-action="Index">
        MySocialPet
        <img src="~/src/paw_logo.svg">
    </a>

    <!-- Botón hamburguesa SOLO móvil -->
    <div class="d-flex align-items-center d-lg-none">
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Abrir menú">
            <!-- Puedes usar el icono de Bootstrap o el tuyo -->
            <i class="bi bi-list menu-icon" id="toggleSidebar"></i>
        </button>
    </div>

    <!-- MENÚ colapsable -->
    <ul class="navbar-nav justify-content-end align-items-stretch quitar-amarillo">

        @if (ViewBag.IsAuthenticated == true)
        {
            <!-- Link a Mis Mascotas (dropdown) -->
            <li class="nav-item nav-section dropdown position-relative">
                <a class="nav-link dropdown-toggle text-white fw-semibold"
                   href="#"
                   id="misMascotasDropdown"
                   role="button"
                   data-bs-toggle="dropdown"
                   aria-expanded="false"
                   aria-haspopup="true">
                    <i class="bi bi-house-heart me-1"></i>Mis Mascotas
                </a>
                <ul class="dropdown-menu shadow rounded-3 p-2"
                    aria-labelledby="misMascotasDropdown"
                    data-bs-auto-close="outside" style="min-width: 220px;">
                    <li>
                        <a class="dropdown-item d-flex align-items-center py-2"
                           asp-controller="Mascota" asp-action="ListaMascota" asp-route-id="@Model">
                            <i class="bi bi-list me-2"></i> Lista Mascota
                        </a>
                    </li>
                    <li>
                        <a class="dropdown-item d-flex align-items-center py-2"
                           asp-controller="Salud" asp-action="SaludRegistro" asp-route-id="@Model">
                            <i class="bi bi-heart-pulse me-2"></i> Salud
                        </a>
                    </li>
                    <li>
                        <a class="dropdown-item d-flex align-items-center py-2"
                           asp-controller="Salud" asp-action="Vacunas" asp-route-id="@Model">
                            <i class="bi bi-clipboard-plus me-2"></i> Vacuna
                        </a>
                    </li>
                    <li>
                        <a class="dropdown-item d-flex align-items-center py-2"
                           asp-controller="Salud" asp-action="CalendarioEventos" asp-route-id="@Model">
                            <i class="bi bi-calendar me-2"></i> Evento
                        </a>
                    </li>
                </ul>
            </li>

            <!-- NUEVO BOTÓN: Protectoras -->
            <li class="nav-item nav-section ">
                <a class="nav-link text-white fw-semibold" asp-controller="Protectora" asp-action="Index">
                    <img src="~/src/shelter_logo.svg" alt="Álbum" class="nav-icon me-1">Protectora
                </a>
            </li>

            <!-- Secciones -->
            <li class="nav-item nav-section">
                <a class="nav-link text-white fw-semibold" asp-controller="Albums" asp-action="ListAlbum">
                    <i class="bi bi-images me-1"></i>Álbum
                </a>
            </li>
            <li class="nav-item nav-section">
                <a class="nav-link text-white fw-semibold" asp-controller="Sugerencia" asp-action="Index">
                    <i class="bi bi-book me-1"></i>Sugerencia
                </a>
            </li>
            <li class="nav-item nav-section">
                <a class="nav-link text-white fw-semibold" asp-controller="Foro" asp-action="Index">
                    <i class="bi bi-chat-dots me-1"></i>Foro
                </a>
            </li>

            <!-- Perfil / Logout -->
            <li class="nav-item nav-section dropdown ps-2">
                <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" role="button"
                   data-bs-toggle="dropdown" aria-expanded="false">
                    <img src="@(string.IsNullOrEmpty(ViewBag.FotoAvatar)
                                                                                               ? Url.Content("~/src/DefaultAvatar/AvatarPerro.png")
                                                                                               : ViewBag.FotoAvatar)"
                     class="rounded-circle me-2"
                     style="width:32px;height:32px;object-fit:cover;"
                     alt="Avatar" loading="lazy" decoding="async" />
                <span class="d-none d-sm-inline">@ViewBag.Username</span>
            </a>
            <ul class="dropdown-menu dropdown-menu-end">
                <li>
                    <a class="dropdown-item d-flex align-items-center" asp-controller="Perfil" asp-action="Index">
                        <i class="bi bi-person me-2"></i> Mi perfil
                    </a>
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="px-2">
                    <form asp-controller="Login" asp-action="Logout" method="post">
                        @Html.AntiForgeryToken()
                        <button type="submit" class="dropdown-item w-100 text-start p-0">
                            <span class="d-flex align-items-center p-2">
                                <i class="bi bi-box-arrow-right me-2"></i> Cerrar sesión
                            </span>
                        </button>
                    </form>
                </li>
            </ul>
        </li>
        }
        else
        {
            @if (currentController == "Login" && currentAction == "Index")
            {
                <!-- Solo mostrar el botón Login cuando estoy en la vista de Login -->
                <li class="nav-item nav-section">
                    <a asp-controller="Login" asp-action="Index" class="btn-login">
                        <span class="icon">
                            <img src="~/src/profile-icon.svg">
                        </span>
                        <span class="text ms-3">Login</span>
                    </a>
                </li>
            }
            else
            {
                <!-- Navegación pública normal -->
                <!-- Navegación pública (siempre apunta a Home/Index con anclas) -->
                <li class="nav-item nav-section">
                    <a class="nav-link" asp-controller="Home" asp-action="Index" asp-fragment="sobre">Sobre</a>
                </li>
                <li class="nav-item nav-section">
                    <a class="nav-link" asp-controller="Home" asp-action="Index" asp-fragment="caracteristicas">Características</a>
                </li>
                <li class="nav-item nav-section">
                    <a class="nav-link" asp-controller="Home" asp-action="Index" asp-fragment="comunidad">Comunidad</a>
                </li>
                <li class="nav-item nav-section">
                    <a class="nav-link" asp-controller="Home" asp-action="Index" asp-fragment="contacto">Contacto</a>
                </li>
                <li class="nav-item ps-2 align-content-center">
                    <a asp-controller="Login" asp-action="Index" class="btn-login">
                        <span class="icon">
                            <img src="~/src/profile-icon.svg">
                        </span>
                        <span class="text ms-3">Login</span>
                    </a>
                </li>
            }
        }

    </ul>
</nav>
